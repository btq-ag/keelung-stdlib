{-# LANGUAGE DataKinds #-}

module Cipher.AES where

import Keelung

-- type Field = Field

-- references
-- https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.197-upd1.pdf
-- https://opensource.apple.com/source/CommonCrypto/CommonCrypto-55010/Source/AESedp/AES.c.auto.html

-- | Constants

-- | Number of columns (32-bit words) comprising the State. For this standard, Nb = 4.
nb :: Int
nb = 4

nk :: Int
nk = 4

nr :: Int
nr = 10

-- | KeyExpansion â€“ round keys are derived from the cipher key using the AES key schedule.
--   AES requires a separate 128-bit round key block for each round plus one more.
-- expandKey = undefined



mixColumns :: (Field, Field, Field, Field) -> (Field, Field, Field, Field) -> (Field, Field, Field, Field)
mixColumns (a0, a1, a2, a3) (b0, b1, b2, b3) = (d0, d1, d2, d3)
  where
    d0 = a0 * b0 + a3 * b1 + a2 * b2 + a1 * b3
    d1 = a1 * b0 + a0 * b1 + a3 * b2 + a2 * b3
    d2 = a2 * b0 + a1 * b1 + a0 * b2 + a3 * b3
    d3 = a3 * b0 + a2 * b1 + a1 * b2 + a0 * b3



-- | SubFields: applies a substitution table (S-box) to each byte
sBox :: Field -> Field
sBox 0x00 = 0x63
sBox 0x01 = 0x7c
sBox 0x02 = 0x77
sBox 0x03 = 0x7b
sBox 0x04 = 0xf2
sBox 0x05 = 0x6b
sBox 0x06 = 0x6f
sBox 0x07 = 0xc5
sBox 0x08 = 0x30
sBox 0x09 = 0x01
sBox 0x0a = 0x67
sBox 0x0b = 0x2b
sBox 0x0c = 0xfe
sBox 0x0d = 0xd7
sBox 0x0e = 0xab
sBox 0x0f = 0x76
sBox 0x10 = 0xca
sBox 0x11 = 0x82
sBox 0x12 = 0xc9
sBox 0x13 = 0x7d
sBox 0x14 = 0xfa
sBox 0x15 = 0x59
sBox 0x16 = 0x47
sBox 0x17 = 0xf0
sBox 0x18 = 0xad
sBox 0x19 = 0xd4
sBox 0x1a = 0xa2
sBox 0x1b = 0xaf
sBox 0x1c = 0x9c
sBox 0x1d = 0xa4
sBox 0x1e = 0x72
sBox 0x1f = 0xc0
sBox 0x20 = 0xb7
sBox 0x21 = 0xfd
sBox 0x22 = 0x93
sBox 0x23 = 0x26
sBox 0x24 = 0x36
sBox 0x25 = 0x3f
sBox 0x26 = 0xf7
sBox 0x27 = 0xcc
sBox 0x28 = 0x34
sBox 0x29 = 0xa5
sBox 0x2a = 0xe5
sBox 0x2b = 0xf1
sBox 0x2c = 0x71
sBox 0x2d = 0xd8
sBox 0x2e = 0x31
sBox 0x2f = 0x15
sBox 0x30 = 0x04
sBox 0x31 = 0xc7
sBox 0x32 = 0x23
sBox 0x33 = 0xc3
sBox 0x34 = 0x18
sBox 0x35 = 0x96
sBox 0x36 = 0x05
sBox 0x37 = 0x9a
sBox 0x38 = 0x07
sBox 0x39 = 0x12
sBox 0x3a = 0x80
sBox 0x3b = 0xe2
sBox 0x3c = 0xeb
sBox 0x3d = 0x27
sBox 0x3e = 0xb2
sBox 0x3f = 0x75
sBox 0x40 = 0x09
sBox 0x41 = 0x83
sBox 0x42 = 0x2c
sBox 0x43 = 0x1a
sBox 0x44 = 0x1b
sBox 0x45 = 0x6e
sBox 0x46 = 0x5a
sBox 0x47 = 0xa0
sBox 0x48 = 0x52
sBox 0x49 = 0x3b
sBox 0x4a = 0xd6
sBox 0x4b = 0xb3
sBox 0x4c = 0x29
sBox 0x4d = 0xe3
sBox 0x4e = 0x2f
sBox 0x4f = 0x84
sBox 0x50 = 0x53
sBox 0x51 = 0xd1
sBox 0x52 = 0x00
sBox 0x53 = 0xed
sBox 0x54 = 0x20
sBox 0x55 = 0xfc
sBox 0x56 = 0xb1
sBox 0x57 = 0x5b
sBox 0x58 = 0x6a
sBox 0x59 = 0xcb
sBox 0x5a = 0xbe
sBox 0x5b = 0x39
sBox 0x5c = 0x4a
sBox 0x5d = 0x4c
sBox 0x5e = 0x58
sBox 0x5f = 0xcf
sBox 0x60 = 0xd0
sBox 0x61 = 0xef
sBox 0x62 = 0xaa
sBox 0x63 = 0xfb
sBox 0x64 = 0x43
sBox 0x65 = 0x4d
sBox 0x66 = 0x33
sBox 0x67 = 0x85
sBox 0x68 = 0x45
sBox 0x69 = 0xf9
sBox 0x6a = 0x02
sBox 0x6b = 0x7f
sBox 0x6c = 0x50
sBox 0x6d = 0x3c
sBox 0x6e = 0x9f
sBox 0x6f = 0xa8
sBox 0x70 = 0x51
sBox 0x71 = 0xa3
sBox 0x72 = 0x40
sBox 0x73 = 0x8f
sBox 0x74 = 0x92
sBox 0x75 = 0x9d
sBox 0x76 = 0x38
sBox 0x77 = 0xf5
sBox 0x78 = 0xbc
sBox 0x79 = 0xb6
sBox 0x7a = 0xda
sBox 0x7b = 0x21
sBox 0x7c = 0x10
sBox 0x7d = 0xff
sBox 0x7e = 0xf3
sBox 0x7f = 0xd2
sBox 0x80 = 0xcd
sBox 0x81 = 0x0c
sBox 0x82 = 0x13
sBox 0x83 = 0xec
sBox 0x84 = 0x5f
sBox 0x85 = 0x97
sBox 0x86 = 0x44
sBox 0x87 = 0x17
sBox 0x88 = 0xc4
sBox 0x89 = 0xa7
sBox 0x8a = 0x7e
sBox 0x8b = 0x3d
sBox 0x8c = 0x64
sBox 0x8d = 0x5d
sBox 0x8e = 0x19
sBox 0x8f = 0x73
sBox 0x90 = 0x60
sBox 0x91 = 0x81
sBox 0x92 = 0x4f
sBox 0x93 = 0xdc
sBox 0x94 = 0x22
sBox 0x95 = 0x2a
sBox 0x96 = 0x90
sBox 0x97 = 0x88
sBox 0x98 = 0x46
sBox 0x99 = 0xee
sBox 0x9a = 0xb8
sBox 0x9b = 0x14
sBox 0x9c = 0xde
sBox 0x9d = 0x5e
sBox 0x9e = 0x0b
sBox 0x9f = 0xdb
sBox 0xa0 = 0xe0
sBox 0xa1 = 0x32
sBox 0xa2 = 0x3a
sBox 0xa3 = 0x0a
sBox 0xa4 = 0x49
sBox 0xa5 = 0x06
sBox 0xa6 = 0x24
sBox 0xa7 = 0x5c
sBox 0xa8 = 0xc2
sBox 0xa9 = 0xd3
sBox 0xaa = 0xac
sBox 0xab = 0x62
sBox 0xac = 0x91
sBox 0xad = 0x95
sBox 0xae = 0xe4
sBox 0xaf = 0x79
sBox 0xb0 = 0xe7
sBox 0xb1 = 0xc8
sBox 0xb2 = 0x37
sBox 0xb3 = 0x6d
sBox 0xb4 = 0x8d
sBox 0xb5 = 0xd5
sBox 0xb6 = 0x4e
sBox 0xb7 = 0xa9
sBox 0xb8 = 0x6c
sBox 0xb9 = 0x56
sBox 0xba = 0xf4
sBox 0xbb = 0xea
sBox 0xbc = 0x65
sBox 0xbd = 0x7a
sBox 0xbe = 0xae
sBox 0xbf = 0x08
sBox 0xc0 = 0xba
sBox 0xc1 = 0x78
sBox 0xc2 = 0x25
sBox 0xc3 = 0x2e
sBox 0xc4 = 0x1c
sBox 0xc5 = 0xa6
sBox 0xc6 = 0xb4
sBox 0xc7 = 0xc6
sBox 0xc8 = 0xe8
sBox 0xc9 = 0xdd
sBox 0xca = 0x74
sBox 0xcb = 0x1f
sBox 0xcc = 0x4b
sBox 0xcd = 0xbd
sBox 0xce = 0x8b
sBox 0xcf = 0x8a
sBox 0xd0 = 0x70
sBox 0xd1 = 0x3e
sBox 0xd2 = 0xb5
sBox 0xd3 = 0x66
sBox 0xd4 = 0x48
sBox 0xd5 = 0x03
sBox 0xd6 = 0xf6
sBox 0xd7 = 0x0e
sBox 0xd8 = 0x61
sBox 0xd9 = 0x35
sBox 0xda = 0x57
sBox 0xdb = 0xb9
sBox 0xdc = 0x86
sBox 0xdd = 0xc1
sBox 0xde = 0x1d
sBox 0xdf = 0x9e
sBox 0xe0 = 0xe1
sBox 0xe1 = 0xf8
sBox 0xe2 = 0x98
sBox 0xe3 = 0x11
sBox 0xe4 = 0x69
sBox 0xe5 = 0xd9
sBox 0xe6 = 0x8e
sBox 0xe7 = 0x94
sBox 0xe8 = 0x9b
sBox 0xe9 = 0x1e
sBox 0xea = 0x87
sBox 0xeb = 0xe9
sBox 0xec = 0xce
sBox 0xed = 0x55
sBox 0xee = 0x28
sBox 0xef = 0xdf
sBox 0xf0 = 0x8c
sBox 0xf1 = 0xa1
sBox 0xf2 = 0x89
sBox 0xf3 = 0x0d
sBox 0xf4 = 0xbf
sBox 0xf5 = 0xe6
sBox 0xf6 = 0x42
sBox 0xf7 = 0x68
sBox 0xf8 = 0x41
sBox 0xf9 = 0x99
sBox 0xfa = 0x2d
sBox 0xfb = 0x0f
sBox 0xfc = 0xb0
sBox 0xfd = 0x54
sBox 0xfe = 0xbb
sBox 0xff = 0x16
sBox _ = 0x00 -- should never happen in GF(256)